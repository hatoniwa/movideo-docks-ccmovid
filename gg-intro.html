<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pharaoh & JK Adventure Game Ver.2 (English Edition)</title>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      background: #f0f0f0;
      text-align: center;
    }
    .hidden { display: none; }
    .btns, #reward-buttons, #lang-buttons, #restart-button {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 20px 0;
      flex-wrap: wrap;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      background-color: #4caf50;
      color: white;
      cursor: pointer;
    }
    button#exit-btn {
      background-color: #f44336;
    }
    button:disabled {
      background-color: #999;
      opacity: 0.5;
      cursor: not-allowed;
    }
    .image-wrapper {
      width: 90%;
      max-width: 800px;
      margin: auto;
      position: relative;
    }
    .scene-img {
      width: 100%;
      display: none;
      border: 2px solid #666;
      border-radius: 10px;
      background-color: #000;
    }
    .subtitle {
      margin-top: 10px;
      font-size: 20px;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 10px;
      border-radius: 10px;
      display: none;
    }
    #result, #score, #final-score, #score-note {
      font-size: 20px;
      margin: 10px;
    }
    #intro {
      padding: 15px;
      font-size: 14px;
    }
    #guide-text {
      font-size: 18px;
      line-height: 1.6;
      white-space: pre-line;
    }
  </style>

  <!-- Google Tag Manager -->
  <script>
  (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-W5RS2555');
  </script>
  <!-- End Google Tag Manager -->
</head>

<body>
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-W5RS2555"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

<div id="intro">
  <h2 id="title">ğŸ® Game Instructions / ã‚²ãƒ¼ãƒ æ¡ˆå†…</h2>
  <p id="guide-text"></p>
  <button id="start-btn" onclick="startGame()">Start Game / ã‚²ãƒ¼ãƒ é–‹å§‹</button>
</div>

<div id="game-area" class="hidden">
  <div id="score-note"></div>
  <div class="btns" id="lang-buttons">
    <button onclick="setLang('en')">ğŸ‡¬ğŸ‡§ English</button>
    <button onclick="setLang('jp')">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</button>
  </div>
  <div class="btns" id="btns-choices">
    <button onclick="choose(1)">â‘ </button>
    <button onclick="choose(2)">â‘¡</button>
    <button onclick="choose(3)">â‘¢</button>
    <button onclick="choose(4)">â‘£</button>
    <button onclick="choose(5)">â‘¤</button>
    <button onclick="choose(6)">â‘¥</button>
  </div>
  <div class="image-wrapper">
    <img id="scene" class="scene-img" />
    <img id="reward-img" class="scene-img" />
  </div>
  <div id="subtitle" class="subtitle"></div>
  <div id="score"></div>
  <div class="btns">
    <button id="end-btn" onclick="endGame()">End Game / çµ‚äº†</button>
  </div>
  <div id="final-score"></div>
  <div id="result"></div>

  <div id="reward-buttons" style="display:none">
    <button onclick="showReward('A')">Reward A</button>
    <button onclick="showReward('B')">Reward B</button>
    <button onclick="showReward('C')">Reward C</button>
  </div>

  <div id="restart-button" style="display:none">
    <button id="restart-btn" onclick="restartGame()">ğŸ” Play Again / ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤</button>
    <button id="exit-btn" onclick="exitGame()">â–¶ï¸ YouTubeã¸ / Exit Game</button>
  </div>
</div>

<script>
  // -------- State --------
  let imageOrder = [], used = [], totalScore = 0;
  let currentLang = 'en';
  let lastSubtitleKey = null;
  let lastZeroSubtitle = null;
  let rewardUsed = false;
  const gameID = 'Pharaoh_JK_Game_2'; // GAã‚¤ãƒ™ãƒ³ãƒˆç”¨ã®ã‚²ãƒ¼ãƒ ID

  // -------- i18n --------
  const i18n = {
    guideText: {
      jp: "ã“ã®ã‚²ãƒ¼ãƒ ã¯ã€1å›ã ã‘ãƒ—ãƒ¬ã‚¤ã§ãã¾ã™ã€‚\n6å€‹ã®ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™é †åºã§ã€å¾—ç‚¹ãŒå¤‰ã‚ã‚Šã¾ã™ã€‚\n300ç‚¹ä»¥ä¸Šã§ã”è¤’ç¾ç”»åƒãŒç”¨æ„ã•ã‚Œã¾ã™ã€‚",
      en: "You can play one round per run.\nYour score depends on the order you press the six buttons.\nEarn 300+ points to unlock a reward image.",
    },
    scoreNote: {
      jp: "ğŸ¯ ã”è¤’ç¾ç”»åƒã«ã¯300ç‚¹ä»¥ä¸ŠãŒå¿…è¦ã§ã™",
      en: "ğŸ¯ 300+ points are required to earn a reward image",
    },
    totalScoreLabel: { jp: "ç·åˆå¾—ç‚¹ï¼š", en: "Total Score: " },
    finalScoreLabel: { jp: "ğŸ¯ æœ€çµ‚å¾—ç‚¹ï¼š", en: "ğŸ¯ Final Score: " },
    unknown: { jp: "ï¼Ÿï¼Ÿï¼Ÿ", en: "???" },
  };

  // -------- Game content --------
  const scoreMap = {
    "./scene1.jpg": 80,
    "./scene2.jpg": 70,
    "./scene3.jpg": 260,
    "./scene4.jpg": 255,
    "./scene5.jpg": 250,
    "./scene6.jpg": 30,
    "./zero.jpg": 0
  };

  const subtitleMap = {
    "./scene1.jpg": { jp: "ãˆã£â€¦ã“ã“ã€ã©ã“ï¼Ÿ ãƒ”ãƒ©ãƒŸãƒƒãƒ‰ã®ä¸­ãªã®ï¼ï¼Ÿ", en: "Huh...? Where am I? Inside a pyramid!?" },
    "./scene2.jpg": { jp: "ãƒ•ã‚¡ãƒ©ã‚ªæ§˜ã€ã“ã®é£Ÿã¹ç‰©ã€ä¸€ç”Ÿã®æ€ã„å‡ºã‚ˆã£ï¼ï¼Ÿ", en: "Pharaoh, this food is unforgettable!" },
    "./scene3.jpg": { jp: "ãã†ã­ã€ã§ã‚‚ãŠå€¤æ®µãŒï¼ï¼Ÿ", en: "Yeah, but what about the price!?" },
    "./scene4.jpg": { jp: "ã“ã‚Œã‚‚ã€æ™‚ç©ºãŒæ»ã‚Œã¦ã‚‹ã£ã¦ã“ã¨ã ã‚ˆã­ï¼ï¼Ÿ", en: "So this is what it means to twist space and time!?" },
    "./scene5.jpg": { jp: "ã¡ã‚‡ã£ã¨ï¼ã‚ã®ãƒ©ã‚¯ãƒ€ã€ç§ã®ãƒªãƒ¥ãƒƒã‚¯é£Ÿã¹ã¦ãªã„ï¼ï¼Ÿ", en: "Wait! Is that camel eating my backpack!?" },
    "./scene6.jpg": { jp: "ã†ã¡ã‚‰ã€ä»²è‰¯ããªã‚Œãã†ã‹ã‚‚ï¼ï¼Ÿ", en: "I feel like we could actually get along!?" }
  };

  const zeroLines = [
    { jp: "ã‚¼ãƒ­ç‚¹ï¼ï¼Ÿ ãã‚“ãªãƒãƒŠãƒŠâ€¦", en: "Zero points!? That's bananas..." },
    { jp: "ã†ã‚ã£ã€è»¢ã‚“ã ï¼ï¼Ÿ", en: "Whoa, you slipped!?" },
    { jp: "ã‚ã¡ã‚ƒãƒ¼ã€ãƒãƒŠãƒŠã«ã‚„ã‚‰ã‚ŒãŸï¼", en: "Oops, taken down by a banana!" }
  ];

  // -------- Language helpers --------
  function applyLang() {
    document.getElementById("title").innerText = "ğŸ® Game Instructions / ã‚²ãƒ¼ãƒ æ¡ˆå†…";
    document.getElementById("guide-text").innerText =
      i18n.guideText.en + "\n\n" + i18n.guideText.jp;
    document.getElementById("start-btn").innerText = "Start Game / ã‚²ãƒ¼ãƒ é–‹å§‹";
    document.getElementById("end-btn").innerText    = "End Game / çµ‚äº†";
    document.getElementById("restart-btn").innerText = "ğŸ” Play Again / ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤";
    document.getElementById("exit-btn").innerText = "â–¶ï¸ YouTubeã¸ / Exit Game";
    const note = document.getElementById("score-note");
    if (note) note.innerText = i18n.scoreNote[currentLang];
    updateScore();
    const subtitle = document.getElementById("subtitle");
    if (subtitle && subtitle.style.display !== "none") {
      if (lastZeroSubtitle) {
        subtitle.innerText = lastZeroSubtitle[currentLang] || i18n.unknown[currentLang];
      } else if (lastSubtitleKey) {
        const sub = subtitleMap[lastSubtitleKey];
        subtitle.innerText = sub ? (sub[currentLang] || i18n.unknown[currentLang]) : i18n.unknown[currentLang];
      }
    }
  }

  function setLang(lang) {
    currentLang = lang;
    applyLang();
  }

  // -------- Game flow --------
  function startGame() {
    document.getElementById("intro").classList.add("hidden");
    document.getElementById("game-area").classList.remove("hidden");
    imageOrder = shuffle(["./scene1.jpg", "./scene2.jpg", "./scene3.jpg", "./scene4.jpg", "./scene5.jpg", "./scene6.jpg"]);
    used = [];
    totalScore = 0;
    rewardUsed = false;
    lastZeroSubtitle = null;
    lastSubtitleKey = null;

    document.getElementById("btns-choices").querySelectorAll("button").forEach(btn => {
      btn.disabled = false;
      btn.style.opacity = "1";
    });
    document.querySelectorAll("#reward-buttons button").forEach(btn => {
      btn.disabled = false;
      btn.style.opacity = "1";
    });

    document.getElementById("reward-buttons").style.display = "none";
    document.getElementById("restart-button").style.display = "none";
    document.getElementById("scene").style.display = "none";
    document.getElementById("reward-img").style.display = "none";
    document.getElementById("subtitle").style.display = "none";
    document.getElementById("final-score").innerText = "";
    document.getElementById("result").innerText = "";
    updateScore();

    // ã‚²ãƒ¼ãƒ é–‹å§‹ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆGA4 / GTM å´ã§æ‹¾ãˆã‚‹ã‚ˆã†ã«ï¼‰
    if (typeof gtag === 'function') {
      gtag('event', 'game_start', {
        'event_category': 'game',
        'event_label': gameID,
        'language': currentLang
      });
    }
  }

  function restartGame() {
    startGame();
  }

  function exitGame() {
    const confirmation = confirm("ã‚²ãƒ¼ãƒ ã‚’çµ‚äº†ã—ã€YouTubeã¸ç§»å‹•ã—ã¾ã™ã‹ï¼Ÿ");
    if (confirmation) {
      window.location.href = "https://youtube.com/shorts/ZBwZzelO6OQ?si=NhFWI1p9wsGIZ-yX";
    }
  }

  function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    // zero.jpgã‚’å¿…ãšä¸€æšãƒ©ãƒ³ãƒ€ãƒ ã«ç½®ã
    array.splice(Math.floor(Math.random() * array.length), 1, "./zero.jpg");
    return array;
  }

  function choose(num) {
    const choiceButton = document.getElementById("btns-choices").querySelector(`button:nth-child(${num})`);
    if (used.includes(num) || choiceButton.disabled) return;

    used.push(num);
    const imgName = imageOrder[num - 1];
    const scoreEarned = scoreMap[imgName] || 0;

    choiceButton.disabled = true;
    choiceButton.style.opacity = "0.5"; // ç„¡åŠ¹åŒ–ã•ã‚ŒãŸãƒœã‚¿ãƒ³ã‚’ã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆ

    const scene = document.getElementById("scene");
    const reward = document.getElementById("reward-img");
    scene.src = imgName;
    scene.style.display = "block";
    reward.style.display = "none";

    if (imgName === "./zero.jpg") {
      totalScore = 0;
      const sub = pickRandom(zeroLines);
      lastZeroSubtitle = sub;
      showSubtitle(sub);
    } else {
      totalScore += scoreEarned;
      const sub = subtitleMap[imgName] || i18n.unknown;
      showSubtitle(sub, imgName);
    }
    updateScore();

    // é¸æŠã‚¤ãƒ™ãƒ³ãƒˆ
    if (typeof gtag === 'function') {
      gtag('event', 'choice_made', {
        'event_category': 'game',
        'event_label': `Choice_${num}`,
        'image_file': imgName,
        'score_change': scoreEarned,
        'current_score': totalScore,
        'choices_made': used.length
      });
    }

    if (used.length === 5) endGame();
  }

  function updateScore() {
    document.getElementById("score").innerText =
      (currentLang === 'jp' ? i18n.totalScoreLabel.jp : i18n.totalScoreLabel.en) + totalScore;
  }

  function showSubtitle(sub, key = null) {
    const subtitle = document.getElementById("subtitle");
    subtitle.innerText = sub[currentLang] || i18n.unknown[currentLang];
    subtitle.style.display = "block";
    if (key) lastSubtitleKey = key;
  }

  function pickRandom(arr) {
    return arr[Math.floor(Math.random() * arr.length)];
  }

  function endGame() {
    document.getElementById("btns-choices").querySelectorAll("button").forEach(btn => {
      btn.disabled = true;
      btn.style.opacity = "0.5";
    });

    document.getElementById("final-score").innerText =
      (currentLang === 'jp' ? i18n.finalScoreLabel.jp : i18n.finalScoreLabel.en) + totalScore;

    const isRewardUnlocked = totalScore >= 300;

    if (isRewardUnlocked) {
      document.getElementById("reward-buttons").style.display = "flex";
      document.getElementById("result").innerText =
        currentLang === 'jp' ? "âœ¨ ã”è¤’ç¾ã‚¢ãƒ³ãƒ­ãƒƒã‚¯ï¼" : "âœ¨ Reward Unlocked!";
    } else {
      document.getElementById("reward-buttons").style.display = "none";
      document.getElementById("result").innerText =
        currentLang === 'jp' ? "æ®‹å¿µï¼ã”è¤’ç¾ã¯300ç‚¹ä»¥ä¸Šã§ã™ã€‚" : "Too bad! Need 300+ for the reward.";
    }

    document.getElementById("restart-button").style.display = "flex";

    if (typeof gtag === 'function') {
      gtag('event', 'game_end', {
        'event_category': 'game',
        'event_label': gameID,
        'final_score': totalScore,
        'is_reward_unlocked': isRewardUnlocked ? 'yes' : 'no'
      });
    }
  }

  function showReward(category) {
    if (rewardUsed) return;
    let filename = "";
    if (category === "A") filename = "scene99.jpg";
    else if (category === "B") filename = "scene98.jpg";
    else if (category === "C") filename = "scene97.jpg";

    const scene = document.getElementById("scene");
    const reward = document.getElementById("reward-img");
    scene.style.display = "none";

    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥å¯¾ç­–ã¨ã—ã¦ã‚¯ã‚¨ãƒªã‚’ä»˜åŠ ï¼ˆæœ€æ–°ç”»åƒã‚’å¿…ãšèª­ã¿ã«è¡Œãï¼‰
    reward.src = filename + "?v=" + Date.now();
    reward.style.display = "block";

    rewardUsed = true;
    document.querySelectorAll("#reward-buttons button").forEach(btn => {
      btn.disabled = true;
      btn.style.opacity = "0.5";
    });
  }

  // -------- Init --------
  window.onload = () => {
    applyLang();
  };
</script>

<!-- Firebase SDKï¼ˆv8ç³»ï¼šã‚°ãƒ­ãƒ¼ãƒãƒ«åå‰ç©ºé–“ç‰ˆï¼‰ -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

<script>
  // --- Firebase init ---
  const firebaseConfig = {
    apiKey: "AIzaSyAF_uyMNSXucv75qdR01ron3eWlkIps0lo",
    authDomain: "movideo-web.firebaseapp.com",
    projectId: "movideo-web",
    storageBucket: "movideo-web.firebasestorage.app",
    messagingSenderId: "328585718940",
    appId: "1:328585718940:web:8870831f0755b41825d159",
    measurementId: "G-MB78677VDD"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // --- Counter: ãƒšãƒ¼ã‚¸ã‚’é–‹ããŸã³ã« +1 ---
  const counterGameID = "game10";

  db.collection("counters").doc(counterGameID).set({
    lastAccess: firebase.firestore.FieldValue.serverTimestamp()
  }, { merge: true })
  .then(() => {
    return db.collection("counters").doc(counterGameID).update({
      count: firebase.firestore.FieldValue.increment(1)
    });
  })
  .catch((err) => {
    console.error("Counter update error:", err);
  });
</script>

</body>
</html>